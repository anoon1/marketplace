import{d as a,r as o,j as e}from"./index-b349b8ac.js";import{B as q}from"./Breadcrumb-9b91b131.js";import{l as z,R as K,h as D,f as Q}from"./ChatReportReasonModel-3dd7864f.js";const h=z(`${a.baseUrl}`),W=(i,d)=>i.getFullYear()===d.getFullYear()&&i.getMonth()===d.getMonth()&&i.getDate()===d.getDate(),X=()=>{const[i,d]=o.useState(""),[S,M]=o.useState(!1),[p,F]=o.useState(""),[j,T]=o.useState(""),[f,u]=o.useState([]),[w,R]=o.useState([]),[x,g]=o.useState([]),[y,U]=o.useState(""),[E,I]=o.useState(!0),[v,C]=o.useState([]),[ee,$]=o.useState(""),m=localStorage.getItem("usertoken"),[c,B]=o.useState([]),b=o.useRef(null);o.useEffect(()=>{b.current&&(b.current.scrollTop=b.current.scrollHeight)},[x,f]),o.useEffect(()=>{(async()=>{if(m)try{const s=await fetch(`${a.baseApiUrl}getSellerProfile`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:m})});if(s.ok){const r=await s.json();B(r.data.id)}else console.error("Failed to get user ID:",s.statusText)}catch(s){console.error("Error during fetch:",s)}})()},[m]);const Y=()=>{M(!0)},_=()=>{M(!1)};o.useEffect(()=>{(async()=>{if(m)try{const s=await fetch(`${a.baseApiUrl}getToUserRooms`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({getToUserId:c})});if(s){const r=await s.json();C(r.data)}else console.error("Failed to get user ID:",s.statusText),U("No Chat Found")}catch(s){console.error("Error during fetch:",s)}})()},[c]);const A=t=>{t!==""&&(R(t),L(t.room_id),d(t.room_id),T(t.room_id),h.emit("joinRoom",t.room_id),I(!1))},L=async t=>{if(m)try{const s=await fetch(`${a.baseApiUrl}getUserOldMessages`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomId:t})});if(s){const r=await s.json();console.log("data.datadata.data",r.lastMessage),r.data.length>0?($(r.lastMessage),O(r.data)):(g([]),u([]))}else console.error("Failed to get Data:",s.statusText)}catch(s){console.error("Error during fetch:",s)}},O=t=>{[...x],[...f],g([]),u([]),t.forEach(s=>{const r={message:s.message_content,timestamp:s.created_at,type:s.sender_id===c?"sent":"received"};s.sender_id===c?g(n=>[...n,r]):u(n=>[...n,r])})},H=t=>{if(t.preventDefault(),p!==""){const s=D().utc().format("YYYY-MM-DD HH:mm:ss");V(p,j,c,s),g([...x,{message:p,timestamp:new Date,type:"sent"}]),h.emit("sendMessage",{message:p,room:j,getToUserId:c,timestamp:new Date}),F("")}},V=async(t,s,r,n)=>{if(t)try{const l=await fetch(`${a.baseApiUrl}saveMessageInDatabase`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t,room:s,getToUserId:r,time:n})});if(l.ok){const k=await l.json()}else console.error("Failed to get user ID:",l.statusText)}catch(l){console.error("Error during fetch:",l)}},J=t=>{const s=D(new Date).format("Do MMMM YYYY"),r=D(t).format("Do MMMM YYYY");return s===r?"Today":r},Z=t=>Q(t,"HH:mm");o.useEffect(()=>(h.on("recieveMessage",t=>{u(s=>[...s,{message:t.message,timestamp:new Date,type:"received"}])}),()=>{h.off("recieveMessage")}),[h]);const[N,P]=o.useState({searchChat:""});o.useEffect(()=>{N&&(async()=>{C("");try{const s=await fetch(`${a.baseApiUrl}searchChatByNameSeller`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({...N,getToUserId:c})});if(s.ok){const r=await s.json();C(r.data)}else console.error("Failed to get user ID:",s.statusText)}catch(s){console.error("Error during fetch:",s)}})()},[N]);function G(t,s){const{name:r,value:n}=t.target;P(l=>({...l,[r]:n}))}return e.jsx("div",{className:"h-[calc(100vh-196px)] overflow-hidden",children:e.jsxs("div",{className:"h-full xl:flex gap-[28px]",children:[S&&e.jsx(K,{onClose:_,roomId:j}),e.jsxs("div",{className:"hidden h-full flex-col xl:flex xl:w-1/4 bg-white",children:[e.jsx("div",{className:"sticky border-b border-[#E0E0E0] px-[24px] py-[30px] pt-[32px]",children:e.jsx("h3",{className:"text-[#1D2D5C] font-[500] text-[18px] leading-[16px]",children:"Your Messages"})}),e.jsxs("div",{className:"flex max-h-full flex-col overflow-auto px-[24px] py-[30px]",children:[e.jsxs("form",{className:"sticky mb-[30px]",children:[e.jsx("input",{type:"text",name:"searchChat",onChange:G,className:"w-full rounded-[5px] bg-[#EFF4FB] py-[14px] pl-[19px] pr-10 text-[14px] outline-none focus:border-primary text-[#64748B] leading-[12px] placeholder:text-[#64748B] placeholder:text-[14px] ",placeholder:"Search..."}),e.jsx("button",{className:"absolute top-1/2 right-4 -translate-y-1/2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:e.jsx("path",{d:"M12.605 11.19C13.4825 10.02 14 8.57 14 7C14 3.14 10.86 0 7 0C3.14 0 0 3.14 0 7C0 10.86 3.14 14 7 14C8.57 14 10.02 13.48 11.19 12.605L14.2925 15.7075C14.4875 15.9025 14.7425 16 15 16C15.2575 16 15.5125 15.9025 15.7075 15.7075C16.0975 15.3175 16.0975 14.685 15.7075 14.2925L12.605 11.19ZM7 12C4.2425 12 2 9.7575 2 7C2 4.2425 4.2425 2 7 2C9.7575 2 12 4.2425 12 7C12 9.7575 9.7575 12 7 12Z",fill:"#64748B"})})})]}),e.jsxs("div",{className:"no-scrollbar max-h-full overflow-auto",children:[v&&v.length>0?e.jsx(e.Fragment,{children:v.map(t=>e.jsxs("div",{onClick:()=>A(t),className:`flex cursor-pointer items-center border-b border-solid border-[#EFF4FB] rounded-[5px] py-[12px] px-[13px] mb-[15px] ${i===t.room_id?"bg-[#EFF4FB]":"bg-[#FFFFFF]"}`,children:[e.jsxs("div",{className:"relative mr-[9px] h-[50px] w-full max-w-[50px] rounded-full border-[3px] border-[#fff] hover:border-[#fff]",children:[t.profile_picture?e.jsx("img",{src:`${a.baseApiUrl}${t.profile_picture}`,alt:"profile",className:"h-full w-full object-cover object-center rounded-full"}):e.jsx("img",{src:`${a.baseApiUrl}${a.DEFAULT_IMG}`,alt:"profile",className:"h-full w-full object-cover object-center rounded-full"}),e.jsx("span",{className:"absolute bottom-0 right-0 block h-3 w-3 rounded-full border-2 border-gray-2 bg-success"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("h5",{className:"text-[#1D2D5C] text-[16px] font-[500] leading-[14px] mb-[5px]",children:t.name}),e.jsx("p",{className:"text-[#535D7A] text-[14px] font-[400] leading-[18px]",children:t.lastmessages?e.jsx(e.Fragment,{children:t.lastmessages}):e.jsx("p",{children:" "})})]})]},t.roomId))}):e.jsx("p",{children:"No Chat Found"}),y&&e.jsx("span",{className:"text-center",children:y&&e.jsx("p",{children:y})})]})]})]}),e.jsxs("div",{className:"flex h-full flex-col xl:w-3/4 bg-[#FFF]",children:[e.jsxs("div",{className:"sticky flex items-center justify-between border-b border-[#E0E0E0] px-[32px] py-[12px] pb-[16px]",children:[e.jsxs("div",{className:"flex cursor-pointer items-center rounded-[5px]",children:[e.jsx("div",{className:"relative mr-[11px] h-[50px] w-full max-w-[50px] rounded-full border-[3px] border-[#fff] hover:border-[#fff] drop-shadow",children:w.profile_picture?e.jsx("img",{src:`${a.baseApiUrl}${w.profile_picture}`,alt:"profile",className:"h-full w-full object-cover object-center rounded-full"}):e.jsx("img",{src:`${a.baseApiUrl}${a.DEFAULT_IMG}`,alt:"profile",className:"h-full w-full object-cover object-center rounded-full"})}),e.jsxs("div",{className:"",children:[e.jsx("h5",{className:"text-[#1D2D5C] text-[14px] font-[500] leading-[12px] mb-[6px] text-black dark:text-white",children:w.name}),e.jsx("p",{className:"text-[#535D7A] text-[14px] font-[400] leading-[14px]"})]})]}),e.jsxs("button",{className:"flex justify-center gap-[6.5px] items-center mt-[20px] cursor-pointer disabled",disabled:E,onClick:Y,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"13",height:"15",viewBox:"0 0 13 15",fill:"none",children:e.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M0.681818 0C0.305264 0 0 0.305264 0 0.681818V14.3182C0 14.6947 0.305264 15 0.681818 15C1.05837 15 1.36364 14.6947 1.36364 14.3182V8.58975C1.68138 8.43157 2.18368 8.21107 2.72217 8.07648C3.68803 7.83505 4.46317 7.92416 4.88727 8.56023C5.67886 9.74755 7.19059 9.85214 8.35405 9.73623C9.5818 9.61391 10.7965 9.21184 11.4105 8.98473C11.95 8.78523 12.2727 8.27291 12.2727 7.73236V3.22048C12.2727 2.16271 11.153 1.54516 10.2606 1.94987C9.53693 2.27808 8.5755 2.6446 7.70666 2.76566C6.79766 2.89232 6.26973 2.72093 6.02182 2.34916C5.12734 1.00747 3.59699 0.848632 2.50019 0.94003C2.07914 0.975123 1.6879 1.04875 1.36364 1.1267V0.681818C1.36364 0.305264 1.05837 0 0.681818 0ZM1.36364 2.53709V7.09411C1.6642 6.97139 2.01556 6.8475 2.39146 6.75355C3.47105 6.48368 5.08227 6.39457 6.02182 7.80375C6.34814 8.29323 7.10011 8.49075 8.21884 8.37934C9.25623 8.27598 10.3242 7.93098 10.9091 7.71627V3.22048C10.9091 3.1895 10.8464 3.18152 10.8239 3.19177C10.0619 3.5373 8.95882 3.96799 7.89484 4.11625C6.87109 4.2589 5.598 4.1717 4.88727 3.1056C4.41811 2.40194 3.56209 2.2199 2.61344 2.29895C2.13003 2.33924 1.68018 2.44518 1.36364 2.53709Z",fill:"#2174F5"})}),e.jsx("span",{className:"text-[#2174F5] text-[14px] font-[500] leading-[22px]",children:"REPORT IT HERE"})]})]}),e.jsx("div",{className:"no-scrollbar max-h-full h-[700px] space-y-3.5 overflow-auto px-6 py-7.5",ref:b,id:"chatmodal",children:[...x,...f].sort((t,s)=>new Date(s.timestamp)-new Date(t.timestamp)).reverse().map((t,s,r)=>{}).length>0?[...x,...f].sort((t,s)=>new Date(s.timestamp)-new Date(t.timestamp)).reverse().map((t,s,r)=>{const n=r[s-1],l=new Date(t.timestamp),k=!n||!W(new Date(n.timestamp),l);return e.jsxs("div",{children:[k&&e.jsx("p",{className:"float-right mb-2 w-[100%] rounded-2xl rounded-tl-none bg-transparent py-[15px] px-[25px] dark:bg-boxdark-2 text-xs font-medium text-center",children:J(l)}),e.jsxs("div",{className:t.type==="sent"?"mb-2.5 rounded-2xl w-[60%] float-right text-wrap rounded-br-none bg-[#2174F5] py-[15px] px-[25px]":"mb-2.5 float-left w-[60%] rounded-2xl rounded-tl-none bg-gray py-[15px] px-[25px] dark:bg-boxdark-2",children:[e.jsx("p",{className:`font-[400] ${t.type==="sent"?"text-white":"text-[#232838]"} text-[14px] leading-[22px]`,children:t.message}),e.jsx("p",{className:`${t.type==="sent"?"text-white":""} text-xs font-medium`,children:Z(l)})]})]},s)}):e.jsx("p",{children:"No chat messages found"})}),e.jsx("div",{className:"sticky bottom-0 border-t border-[#CCD9E7] bg-white py-[30px] px-[30px]",children:e.jsxs("form",{className:"flex items-center justify-between space-x-[20px]",children:[e.jsx("div",{className:"relative w-full",children:e.jsx("div",{className:"relative w-full",children:e.jsx("input",{type:"text",value:p,disabled:E,onChange:t=>{F(t.target.value)},placeholder:"Type something here",className:"w-full rounded-md border border-[#E2E8F0] bg-[#EFF4FB] py-[14px] px-[20px] font-[400] text-[#64748B] placeholder:text-[#64748B]  placeholder-body leading-[24px] outline-none text-[16px] pb-[13px]"})})}),e.jsx("button",{onClick:H,className:"flex h-[52px] w-full max-w-13 items-center justify-center rounded-[6px] bg-[#2174F5] text-white hover:bg-opacity-90",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M22 2L11 13",stroke:"white","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e.jsx("path",{d:"M22 2L15 22L11 13L2 9L22 2Z",stroke:"white","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})]})})]})})]})]})})},oe=()=>e.jsxs(e.Fragment,{children:[e.jsx(q,{pageName:"Messages"}),e.jsx(X,{})]});export{oe as default};
